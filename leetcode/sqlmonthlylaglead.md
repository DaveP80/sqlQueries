## MySQL
## Hard strata scratch
Given a table of purchases by date, calculate the month-over-month percentage change in revenue. The output should include 
the year-month date (YYYY-MM) and percentage change, rounded to the 2nd decimal point, and sorted from the beginning of 
the year to the end of the year.
The percentage change column will be populated from the 2nd month forward and can be calculated as ((this month's 
revenue - last month's revenue) / last month's revenue)*100.
<table class="ResultsTable__table"><thead><tr class="ResultsTable__header-row"><th class="ResultsTable__header-cell">id</th><th class="ResultsTable__header-cell">created_at</th><th class="ResultsTable__header-cell">value</th><th class="ResultsTable__header-cell">purchase_id</th></tr></thead><tbody><tr class="ResultsTable__row "><td class="ResultsTable__cell">1</td><td class="ResultsTable__cell">2019-01-01</td><td class="ResultsTable__cell">172692</td><td class="ResultsTable__cell">43</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2</td><td class="ResultsTable__cell">2019-01-05</td><td class="ResultsTable__cell">177194</td><td class="ResultsTable__cell">36</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">3</td><td class="ResultsTable__cell">2019-01-09</td><td class="ResultsTable__cell">109513</td><td class="ResultsTable__cell">30</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">4</td><td class="ResultsTable__cell">2019-01-13</td><td class="ResultsTable__cell">164911</td><td class="ResultsTable__cell">30</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">5</td><td class="ResultsTable__cell">2019-01-17</td><td class="ResultsTable__cell">198872</td><td class="ResultsTable__cell">39</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">6</td><td class="ResultsTable__cell">2019-01-21</td><td class="ResultsTable__cell">184853</td><td class="ResultsTable__cell">31</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">7</td><td class="ResultsTable__cell">2019-01-25</td><td class="ResultsTable__cell">186817</td><td class="ResultsTable__cell">26</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">8</td><td class="ResultsTable__cell">2019-01-29</td><td class="ResultsTable__cell">137784</td><td class="ResultsTable__cell">22</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">9</td><td class="ResultsTable__cell">2019-02-02</td><td class="ResultsTable__cell">140032</td><td class="ResultsTable__cell">25</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">10</td><td class="ResultsTable__cell">2019-02-06</td><td class="ResultsTable__cell">116948</td><td class="ResultsTable__cell">43</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">11</td><td class="ResultsTable__cell">2019-02-10</td><td class="ResultsTable__cell">162515</td><td class="ResultsTable__cell">25</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">12</td><td class="ResultsTable__cell">2019-02-14</td><td class="ResultsTable__cell">114256</td><td class="ResultsTable__cell">12</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">13</td><td class="ResultsTable__cell">2019-02-18</td><td class="ResultsTable__cell">197465</td><td class="ResultsTable__cell">48</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">14</td><td class="ResultsTable__cell">2019-02-22</td><td class="ResultsTable__cell">120741</td><td class="ResultsTable__cell">20</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">15</td><td class="ResultsTable__cell">2019-02-26</td><td class="ResultsTable__cell">100074</td><td class="ResultsTable__cell">49</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">16</td><td class="ResultsTable__cell">2019-03-02</td><td class="ResultsTable__cell">157548</td><td class="ResultsTable__cell">19</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">17</td><td class="ResultsTable__cell">2019-03-06</td><td class="ResultsTable__cell">105506</td><td class="ResultsTable__cell">16</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">18</td><td class="ResultsTable__cell">2019-03-10</td><td class="ResultsTable__cell">189351</td><td class="ResultsTable__cell">46</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">19</td><td class="ResultsTable__cell">2019-03-14</td><td class="ResultsTable__cell">191231</td><td class="ResultsTable__cell">29</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">20</td><td class="ResultsTable__cell">2019-03-18</td><td class="ResultsTable__cell">120575</td><td class="ResultsTable__cell">44</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">21</td><td class="ResultsTable__cell">2019-03-22</td><td class="ResultsTable__cell">151688</td><td class="ResultsTable__cell">47</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">22</td><td class="ResultsTable__cell">2019-03-26</td><td class="ResultsTable__cell">102327</td><td class="ResultsTable__cell">18</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">23</td><td class="ResultsTable__cell">2019-03-30</td><td class="ResultsTable__cell">156147</td><td class="ResultsTable__cell">25</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">24</td><td class="ResultsTable__cell">2019-04-03</td><td class="ResultsTable__cell">192530</td><td class="ResultsTable__cell">36</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">25</td><td class="ResultsTable__cell">2019-04-07</td><td class="ResultsTable__cell">154765</td><td class="ResultsTable__cell">42</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">26</td><td class="ResultsTable__cell">2019-04-11</td><td class="ResultsTable__cell">113336</td><td class="ResultsTable__cell">12</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">27</td><td class="ResultsTable__cell">2019-04-15</td><td class="ResultsTable__cell">129073</td><td class="ResultsTable__cell">50</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">28</td><td class="ResultsTable__cell">2019-04-19</td><td class="ResultsTable__cell">123477</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">29</td><td class="ResultsTable__cell">2019-04-23</td><td class="ResultsTable__cell">182142</td><td class="ResultsTable__cell">31</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">30</td><td class="ResultsTable__cell">2019-04-27</td><td class="ResultsTable__cell">116546</td><td class="ResultsTable__cell">39</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">31</td><td class="ResultsTable__cell">2019-05-01</td><td class="ResultsTable__cell">174748</td><td class="ResultsTable__cell">26</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">32</td><td class="ResultsTable__cell">2019-05-05</td><td class="ResultsTable__cell">155693</td><td class="ResultsTable__cell">42</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">33</td><td class="ResultsTable__cell">2019-05-09</td><td class="ResultsTable__cell">103012</td><td class="ResultsTable__cell">25</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">34</td><td class="ResultsTable__cell">2019-05-13</td><td class="ResultsTable__cell">187960</td><td class="ResultsTable__cell">33</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">35</td><td class="ResultsTable__cell">2019-05-17</td><td class="ResultsTable__cell">101202</td><td class="ResultsTable__cell">18</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">36</td><td class="ResultsTable__cell">2019-05-21</td><td class="ResultsTable__cell">112522</td><td class="ResultsTable__cell">10</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">37</td><td class="ResultsTable__cell">2019-05-25</td><td class="ResultsTable__cell">195969</td><td class="ResultsTable__cell">37</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">38</td><td class="ResultsTable__cell">2019-05-29</td><td class="ResultsTable__cell">117284</td><td class="ResultsTable__cell">40</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">39</td><td class="ResultsTable__cell">2019-06-02</td><td class="ResultsTable__cell">112956</td><td class="ResultsTable__cell">36</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">40</td><td class="ResultsTable__cell">2019-06-06</td><td class="ResultsTable__cell">174157</td><td class="ResultsTable__cell">29</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">41</td><td class="ResultsTable__cell">2019-06-10</td><td class="ResultsTable__cell">125975</td><td class="ResultsTable__cell">45</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">42</td><td class="ResultsTable__cell">2019-06-14</td><td class="ResultsTable__cell">110340</td><td class="ResultsTable__cell">29</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">43</td><td class="ResultsTable__cell">2019-06-18</td><td class="ResultsTable__cell">143066</td><td class="ResultsTable__cell">31</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">44</td><td class="ResultsTable__cell">2019-06-22</td><td class="ResultsTable__cell">153270</td><td class="ResultsTable__cell">11</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">45</td><td class="ResultsTable__cell">2019-06-26</td><td class="ResultsTable__cell">139635</td><td class="ResultsTable__cell">29</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">46</td><td class="ResultsTable__cell">2019-06-30</td><td class="ResultsTable__cell">157071</td><td class="ResultsTable__cell">35</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">47</td><td class="ResultsTable__cell">2019-07-04</td><td class="ResultsTable__cell">166552</td><td class="ResultsTable__cell">18</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">48</td><td class="ResultsTable__cell">2019-07-08</td><td class="ResultsTable__cell">197587</td><td class="ResultsTable__cell">34</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">49</td><td class="ResultsTable__cell">2019-07-12</td><td class="ResultsTable__cell">103958</td><td class="ResultsTable__cell">37</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">50</td><td class="ResultsTable__cell">2019-07-16</td><td class="ResultsTable__cell">111305</td><td class="ResultsTable__cell">28</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">51</td><td class="ResultsTable__cell">2019-07-20</td><td class="ResultsTable__cell">190266</td><td class="ResultsTable__cell">39</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">52</td><td class="ResultsTable__cell">2019-07-24</td><td class="ResultsTable__cell">116060</td><td class="ResultsTable__cell">44</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">53</td><td class="ResultsTable__cell">2019-07-28</td><td class="ResultsTable__cell">163802</td><td class="ResultsTable__cell">48</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">54</td><td class="ResultsTable__cell">2019-08-01</td><td class="ResultsTable__cell">188558</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">55</td><td class="ResultsTable__cell">2019-08-05</td><td class="ResultsTable__cell">166528</td><td class="ResultsTable__cell">49</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">56</td><td class="ResultsTable__cell">2019-08-09</td><td class="ResultsTable__cell">141463</td><td class="ResultsTable__cell">28</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">57</td><td class="ResultsTable__cell">2019-08-13</td><td class="ResultsTable__cell">120110</td><td class="ResultsTable__cell">34</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">58</td><td class="ResultsTable__cell">2019-08-17</td><td class="ResultsTable__cell">159368</td><td class="ResultsTable__cell">12</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">59</td><td class="ResultsTable__cell">2019-08-21</td><td class="ResultsTable__cell">184900</td><td class="ResultsTable__cell">46</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">60</td><td class="ResultsTable__cell">2019-08-25</td><td class="ResultsTable__cell">190372</td><td class="ResultsTable__cell">38</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">61</td><td class="ResultsTable__cell">2019-08-29</td><td class="ResultsTable__cell">195877</td><td class="ResultsTable__cell">15</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">62</td><td class="ResultsTable__cell">2019-09-02</td><td class="ResultsTable__cell">143221</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">63</td><td class="ResultsTable__cell">2019-09-06</td><td class="ResultsTable__cell">160413</td><td class="ResultsTable__cell">41</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">64</td><td class="ResultsTable__cell">2019-09-10</td><td class="ResultsTable__cell">183919</td><td class="ResultsTable__cell">43</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">65</td><td class="ResultsTable__cell">2019-09-14</td><td class="ResultsTable__cell">134535</td><td class="ResultsTable__cell">34</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">66</td><td class="ResultsTable__cell">2019-09-18</td><td class="ResultsTable__cell">188646</td><td class="ResultsTable__cell">31</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">67</td><td class="ResultsTable__cell">2019-09-22</td><td class="ResultsTable__cell">122706</td><td class="ResultsTable__cell">27</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">68</td><td class="ResultsTable__cell">2019-09-26</td><td class="ResultsTable__cell">160016</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">69</td><td class="ResultsTable__cell">2019-09-30</td><td class="ResultsTable__cell">186777</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">70</td><td class="ResultsTable__cell">2019-10-04</td><td class="ResultsTable__cell">165442</td><td class="ResultsTable__cell">50</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">71</td><td class="ResultsTable__cell">2019-10-08</td><td class="ResultsTable__cell">172445</td><td class="ResultsTable__cell">43</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">72</td><td class="ResultsTable__cell">2019-10-12</td><td class="ResultsTable__cell">167910</td><td class="ResultsTable__cell">21</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">73</td><td class="ResultsTable__cell">2019-10-16</td><td class="ResultsTable__cell">116646</td><td class="ResultsTable__cell">35</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">74</td><td class="ResultsTable__cell">2019-10-20</td><td class="ResultsTable__cell">163287</td><td class="ResultsTable__cell">15</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">75</td><td class="ResultsTable__cell">2019-10-24</td><td class="ResultsTable__cell">187293</td><td class="ResultsTable__cell">43</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">76</td><td class="ResultsTable__cell">2019-10-28</td><td class="ResultsTable__cell">144823</td><td class="ResultsTable__cell">11</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">77</td><td class="ResultsTable__cell">2019-11-01</td><td class="ResultsTable__cell">118317</td><td class="ResultsTable__cell">10</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">78</td><td class="ResultsTable__cell">2019-11-05</td><td class="ResultsTable__cell">166105</td><td class="ResultsTable__cell">38</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">79</td><td class="ResultsTable__cell">2019-11-09</td><td class="ResultsTable__cell">121128</td><td class="ResultsTable__cell">11</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">80</td><td class="ResultsTable__cell">2019-11-13</td><td class="ResultsTable__cell">177355</td><td class="ResultsTable__cell">38</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">81</td><td class="ResultsTable__cell">2019-11-17</td><td class="ResultsTable__cell">176442</td><td class="ResultsTable__cell">50</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">82</td><td class="ResultsTable__cell">2019-11-21</td><td class="ResultsTable__cell">129837</td><td class="ResultsTable__cell">10</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">83</td><td class="ResultsTable__cell">2019-11-25</td><td class="ResultsTable__cell">122363</td><td class="ResultsTable__cell">38</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">84</td><td class="ResultsTable__cell">2019-11-29</td><td class="ResultsTable__cell">125469</td><td class="ResultsTable__cell">10</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">85</td><td class="ResultsTable__cell">2019-12-03</td><td class="ResultsTable__cell">109657</td><td class="ResultsTable__cell">20</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">86</td><td class="ResultsTable__cell">2019-12-07</td><td class="ResultsTable__cell">108782</td><td class="ResultsTable__cell">35</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">87</td><td class="ResultsTable__cell">2019-12-11</td><td class="ResultsTable__cell">149235</td><td class="ResultsTable__cell">18</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">88</td><td class="ResultsTable__cell">2019-12-15</td><td class="ResultsTable__cell">187243</td><td class="ResultsTable__cell">36</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">89</td><td class="ResultsTable__cell">2019-12-19</td><td class="ResultsTable__cell">152538</td><td class="ResultsTable__cell">20</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">90</td><td class="ResultsTable__cell">2019-12-23</td><td class="ResultsTable__cell">178861</td><td class="ResultsTable__cell">34</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">91</td><td class="ResultsTable__cell">2019-12-27</td><td class="ResultsTable__cell">122675</td><td class="ResultsTable__cell">30</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">92</td><td class="ResultsTable__cell">2019-12-31</td><td class="ResultsTable__cell">104037</td><td class="ResultsTable__cell">18</td></tr></tbody></table>

```sql
WITH cte AS (
SELECT created_at, SUM(value) as total FROM
(
select CONCAT(YEAR(created_at), '-', CASE WHEN MONTH(created_at) < 10 THEN '0' ELSE '' END, MONTH(created_at)) created_at, value from sf_transactions ORDER BY created_at
) a GROUP BY created_at
)
SELECT created_at as 'year_month', 
ROUND(((total - LAG(total) OVER (ORDER BY created_at))/LAG(total) OVER (ORDER BY created_at))*100, 2) as revenue_diff_pct FROM 
(
SELECT * FROM cte
) b;
```
### postgres
```sql
WITH cte AS (
SELECT created_at, SUM(value) as total FROM
(
select CONCAT(EXTRACT(YEAR FROM created_at), '-', CASE WHEN EXTRACT(MONTH FROM created_at) < 10 THEN '0' ELSE '' END, EXTRACT(MONTH FROM created_at)) created_at, value from sf_transactions sf ORDER BY created_at
) a GROUP BY created_at
)
SELECT created_at year_month, 
ROUND(((total - LAG(total) OVER (ORDER BY created_at))/LAG(total) OVER (ORDER BY created_at))*100, 2) as revenue_diff_pct FROM 
(
SELECT * FROM cte
) b;
```
<table class="ResultsTable__table"><thead><tr class="ResultsTable__header-row"><th class="ResultsTable__header-cell">year_month</th><th class="ResultsTable__header-cell">revenue_diff_pct</th></tr></thead><tbody><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-01</td><td class="ResultsTable__cell"></td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-02</td><td class="ResultsTable__cell">-28.56</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-03</td><td class="ResultsTable__cell">23.35</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-04</td><td class="ResultsTable__cell">-13.84</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-05</td><td class="ResultsTable__cell">13.49</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-06</td><td class="ResultsTable__cell">-2.78</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-07</td><td class="ResultsTable__cell">-6</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-08</td><td class="ResultsTable__cell">28.36</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-09</td><td class="ResultsTable__cell">-4.97</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-10</td><td class="ResultsTable__cell">-12.68</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-11</td><td class="ResultsTable__cell">1.71</td></tr><tr class="ResultsTable__row "><td class="ResultsTable__cell">2019-12</td><td class="ResultsTable__cell">-2.11</td></tr></tbody></table>